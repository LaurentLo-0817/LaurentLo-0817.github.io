<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> FPGA-Accelerated Audio Beat Detection Using Spectral Flux Analysis | Wen Chieh (Laurent) Lo </title> <meta name="author" content="Wen Chieh (Laurent) Lo"> <meta name="description" content="Developed a music recording and automatic beat detection system on FPGA."> <meta name="keywords" content="ASIC, FPGA, Hardware Acceleration, Computer Architecture"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://laurentlo-0817.github.io/projects/2_project/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Wen Chieh (Laurent) Lo </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About Me </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">FPGA-Accelerated Audio Beat Detection Using Spectral Flux Analysis</h1> <p class="post-description">Developed a music recording and automatic beat detection system on FPGA.</p> </header> <article> <h2 id="overview">Overview</h2> <p>This project implements an Onset Detection Algorithm on an FPGA to enhance audio beat detection in a rhythm game. The algorithm is critical for analyzing audio signals and identifying rhythmic points by detecting sudden increases in signal energy, commonly corresponding to beats or note onsets in music.</p> <p>The core of the detection process involves dividing audio into small segments, transforming them into the frequency domain using the Fast Fourier Transform (FFT), and calculating the Spectral Flux, which measures the energy differences across consecutive segments. Positive differences in spectral energy indicate potential beats. These are further filtered using a moving average to confirm significant rhythmic events.</p> <hr> <h1 id="onset-detection-algorithm">Onset Detection Algorithm</h1> <p>The Onset Detection Algorithm is the core component of the FPGA-accelerated audio beat detection system. It identifies rhythmic points in audio by detecting sudden increases in signal energy, which correspond to beats or note onsets in music.</p> <div class="row justify-content-center"> <div class="col-6 mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/Onset_Detection-480.webp 480w,/assets/img/Onset_Detection-800.webp 800w,/assets/img/Onset_Detection-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/Onset_Detection.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Full-Width Image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="steps-of-the-algorithm">Steps of the Algorithm</h2> <ul> <li> <strong>Audio Segmentation</strong><br> The audio signal is divided into small overlapping segments. Each segment represents a window of audio data for analysis.</li> </ul> <div class="row justify-content-center"> <div class="col-6 mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/Audio_Segmentation-480.webp 480w,/assets/img/Audio_Segmentation-800.webp 800w,/assets/img/Audio_Segmentation-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/Audio_Segmentation.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Full-Width Image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li> <strong>Frequency Domain Transformation</strong> <ul> <li>A <strong>Fast Fourier Transform (FFT)</strong> is applied to each segment, converting the signal from the time domain to the frequency domain.</li> <li>The frequency components allow us to analyze the energy distribution of the signal.</li> </ul> </li> </ul> <div class="row justify-content-center"> <div class="col-6 mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/FFT-480.webp 480w,/assets/img/FFT-800.webp 800w,/assets/img/FFT-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/FFT.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Full-Width Image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li> <strong>Spectral Flux Calculation</strong> <ul> <li>For each frequency, the energy difference between the current window and the previous window is calculated.</li> <li> <strong>Positive Differences</strong>: Indicate an increase in energy, potentially corresponding to an onset (beat).</li> <li> <strong>Negative Differences</strong>: Ignored, as they represent a decrease in energy (decay).</li> </ul> </li> <li> <strong>Moving Average Filtering</strong> <ul> <li>A moving average is computed using the energy values from a set of preceding and following windows.</li> <li>If the energy in the current window exceeds the moving average by a defined threshold, it is marked as a rhythmic point (onset).</li> </ul> </li> <li> <strong>Storing Onset Data</strong> <ul> <li>Identified onsets are encoded into the audio data by modifying the least significant bit (LSB) of the original 16-bit signal.</li> <li>This method synchronizes drum hits with the audio while minimizing additional memory usage.</li> </ul> </li> </ul> <hr> <h2 id="fpga-implementation">FPGA Implementation</h2> <ul> <li> <strong>System Block Diagram</strong>:<br> The hardware system for FPGA-accelerated audio beat detection is designed as a modular and efficient architecture. It consists of a Top Module that orchestrates system states, including audio recording, processing, and playback, supported by an Audio Module with I²C-driven devices for capturing and outputting audio. Core to the system is the Onset Detection Module, which employs FFT for spectral analysis, a flux calculator for detecting energy changes, and a moving average filter to identify beats. Detected beats are encoded into SRAM for synchronization with gameplay visuals and audio. The design incorporates pipelined processing, fixed-point optimization, and resource sharing to maximize performance and minimize latency, providing a responsive and accurate rhythm detection system.</li> </ul> <div class="row justify-content-center"> <div class="col-6 mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/Onset_Detection_Top_Module-480.webp 480w,/assets/img/Onset_Detection_Top_Module-800.webp 800w,/assets/img/Onset_Detection_Top_Module-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/Onset_Detection_Top_Module.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Full-Width Image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li> <strong>FFT Module</strong>:<br> Processes audio segments to extract frequency-domain data. Uses an 8-point FFT with 256 overlapping windows for efficient signal processing under FPGA resource constraints.</li> </ul> <div class="row justify-content-center"> <div class="col-6 mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/FFT_butterfly-480.webp 480w,/assets/img/FFT_butterfly-800.webp 800w,/assets/img/FFT_butterfly-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/FFT_butterfly.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Full-Width Image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li> <p><strong>Flux Calculator</strong>:<br> Accumulates and compares spectral flux values across windows to calculate the energy difference.</p> </li> <li> <p><strong>Moving Average Module</strong>:<br> Computes the average energy across multiple windows to filter significant onsets.</p> </li> <li> <p><strong>Memory Optimization</strong>:<br> Uses SRAM to store intermediate FFT results and onset data, ensuring efficient resource usage.</p> </li> </ul> <hr> <h2 id="result">Result</h2> <ul> <li> <strong>Resource Usage</strong>:</li> </ul> <div class="row justify-content-center"> <div class="col-6 mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/Resource_Usage-480.webp 480w,/assets/img/Resource_Usage-800.webp 800w,/assets/img/Resource_Usage-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/Resource_Usage.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Full-Width Image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li> <strong>DEMO Video</strong> <br> <a href="https://www.youtube.com/watch?v=9JwqjSBcTBg&amp;ab_channel=DCLabNTUEE" rel="external nofollow noopener" target="_blank">Watch on YouTube</a> </li> </ul> <div style="text-align: center;"> <video width="560" height="315" controls=""> <source src="../assets/video/Beat_the_drum_demo.mp4" type="video/mp4"></source> Your browser does not support the video tag. </video> </div> <hr> </article> <div id="giscus_thread" style="max-width: 1200px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"LaurentLo-0817/LaurentLo-0817.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Wen Chieh (Laurent) Lo. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>